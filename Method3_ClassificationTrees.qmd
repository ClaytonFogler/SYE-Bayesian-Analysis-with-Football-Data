---
title: "Method3_ClassificationTrees"
author: "Clayton Fogler"
format: html
editor: visual
---

\*remove situation bins from tree, bagging, forest sections and see what happens

Starting a new section or even new project almost, instead of log we are going to do classification trees:

Just for easy access and simplicity, just going to recode the data down here:

```{r}
library(rpart.plot)
library(rpart)
```


```{r}
all_seasons_trees <- all_seasons |>
  mutate(
    RP = factor(RP),
    DN = factor(DN),
    PERSONNEL = factor(PERSONNEL),
    SUCCESSFUL = factor(SUCCESSFUL)
  ) |>
  select(
    SUCCESSFUL, RP, DIST, DN, PERSONNEL
  )
```


```{r}
all_seasons_trees$SUCCESSFUL <- factor(all_seasons_trees$SUCCESSFUL,
                                       levels = c(0, 1),
                                       labels = c("No", "Yes"))

```


```{r}
table(all_seasons_trees$SUCCESSFUL)
```



```{r}
count.matrix <- table(all_seasons_trees$SUCCESSFUL, predict(tree, type = "raw"))
rownames(count.matrix) <- c("Actual Fails", "Actual Successes")
colnames(count.matrix) <- c("Predicted Fails", "Predicted Successes")
count.matrix
```


```{r}
ctrl <- trainControl(
  method = "cv",    # cross-validation
  number = 5,       # 5 folds
  classProbs = TRUE, # needed if you want predicted probabilities
  summaryFunction = twoClassSummary # optional, for ROC etc.
)

```

```{r}
set.seed(123) # for reproducibility

tree <- train(
  SUCCESSFUL ~ RP + DIST + DN + PERSONNEL,
  data = all_seasons_trees,
  method = "rpart",
  trControl = ctrl,
  metric = "ROC", # could also use "ROC"
  tuneLength = 10      # lets caret try different tree sizes
)

```

```{r}
count.matrix <- table(all_seasons_trees$SUCCESSFUL, predict(tree, type = "raw"))
rownames(count.matrix) <- c("Actual Fails", "Actual Successes")
colnames(count.matrix) <- c("Predicted Fails", "Predicted Successes")
count.matrix
```

```{r}
tree
plot(tree)
rpart.plot(tree$finalModel, snip = TRUE)
rpart.plot(tree$finalModel, extra = 104)

```

```{r}
pred_tree <- predict(tree, newdata = all_seasons_trees)

actual_tree <- all_seasons_trees$SUCCESSFUL

classification_rate3 <- mean(pred_tree == actual_tree)

classification_rate3

```

Classification Rate for our Classification Tree is 0.665 or 66.5%, which is better than both our base logistic regression model, and our logistic regression model with interaction.






















